!function(t){var i={};function e(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,e),s.l=!0,s.exports}e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=2)}([function(t,i){t.exports=Quill},function(t,i,e){"use strict";e.r(i);var n=e(0),s=e.n(n),o={TAB:"Tab",ENTER:"Enter",ESCAPE:27,UP:"ArrowUp",DOWN:"ArrowDown"};e(4);const h=s.a.import("blots/embed");class a extends h{static create(t){const i=super.create(),e=document.createElement("span");return e.className="ql-mention-denotation-char",e.innerHTML=t.denotationChar,i.appendChild(e),i.innerHTML+=t.value,i.dataset.id=t.id,i.dataset.value=t.value,i.dataset.denotationChar=t.denotationChar,t.link&&(i.dataset.link=t.link),i}static value(t){return{id:t.dataset.id,value:t.dataset.value,link:t.dataset.link||null,denotationChar:t.dataset.denotationChar}}}a.blotName="mention",a.tagName="span",a.className="mention",s.a.register(a);class r{constructor(t,i){this.isOpen=!1,this.itemIndex=0,this.mentionCharPos=null,this.cursorPos=null,this.values=[],this.suspendMouseEnter=!1,this.quill=t,this.options={source:null,renderItem:(t,i)=>`${t.value}`,mentionDenotationChars:["@"],allowedChars:/^[a-zA-Z0-9_]*$/,minChars:0,maxChars:31,offsetTop:2,offsetLeft:0,isolateCharacter:!1,fixMentionsToQuill:!1,defaultMenuOrientation:"bottom"},Object.assign(this.options,i),this.mentionContainer=document.createElement("div"),this.mentionContainer.className="ql-mention-list-container",this.mentionContainer.style.cssText="display: none; position: absolute;",this.mentionContainer.onmousemove=this.onContainerMouseMove.bind(this),this.options.fixMentionsToQuill&&(this.mentionContainer.style.width="auto"),this.mentionList=document.createElement("ul"),this.mentionList.className="ql-mention-list",this.mentionContainer.appendChild(this.mentionList),this.quill.container.appendChild(this.mentionContainer),t.on("text-change",this.onTextChange.bind(this)),t.on("selection-change",this.onSelectionChange.bind(this)),t.keyboard.addBinding({key:o.TAB},this.selectHandler.bind(this)),t.keyboard.bindings[o.TAB].unshift(t.keyboard.bindings[o.TAB].pop()),t.keyboard.addBinding({key:o.ENTER},this.selectHandler.bind(this)),t.keyboard.bindings[o.ENTER].unshift(t.keyboard.bindings[o.ENTER].pop()),t.keyboard.addBinding({key:o.ESCAPE},this.escapeHandler.bind(this)),t.keyboard.addBinding({key:o.UP},this.upHandler.bind(this)),t.keyboard.addBinding({key:o.DOWN},this.downHandler.bind(this))}selectHandler(){return!this.isOpen||(this.selectItem(),!1)}escapeHandler(){return!this.isOpen||(this.hideMentionList(),!1)}upHandler(){return!this.isOpen||(this.prevItem(),!1)}downHandler(){return!this.isOpen||(this.nextItem(),!1)}showMentionList(){this.mentionContainer.style.visibility="hidden",this.mentionContainer.style.display="",this.setMentionContainerPosition(),this.isOpen=!0}hideMentionList(){this.mentionContainer.style.display="none",this.isOpen=!1}highlightItem(t=!0){for(let t=0;t<this.mentionList.childNodes.length;t+=1)this.mentionList.childNodes[t].classList.remove("selected");if(this.mentionList.childNodes[this.itemIndex].classList.add("selected"),t){const t=this.mentionList.childNodes[this.itemIndex].offsetHeight,i=this.itemIndex*t,e=this.mentionContainer.scrollTop,n=e+this.mentionContainer.offsetHeight;i<e?this.mentionContainer.scrollTop=i:i>n-t&&(this.mentionContainer.scrollTop+=i-n+t)}}getItemData(){const t=this.mentionList.childNodes[this.itemIndex].dataset.link;return{id:this.mentionList.childNodes[this.itemIndex].dataset.id,value:t?`<a href="${t}" target="_blank">${this.mentionList.childNodes[this.itemIndex].dataset.value}`:this.mentionList.childNodes[this.itemIndex].dataset.value,link:t||null,denotationChar:this.mentionList.childNodes[this.itemIndex].dataset.denotationChar}}onContainerMouseMove(){this.suspendMouseEnter=!1}selectItem(){const t=this.getItemData();this.quill.deleteText(this.mentionCharPos,this.cursorPos-this.mentionCharPos,s.a.sources.API),this.quill.insertEmbed(this.mentionCharPos,"mention",t,s.a.sources.API),this.quill.insertText(this.mentionCharPos+1," ",s.a.sources.API),this.quill.setSelection(this.mentionCharPos+2,s.a.sources.API),this.hideMentionList()}onItemMouseEnter(t){if(this.suspendMouseEnter)return;const i=Number(t.target.dataset.index);Number.isNaN(i)||i===this.itemIndex||(this.itemIndex=i,this.highlightItem(!1))}onItemClick(t){t.stopImmediatePropagation(),t.preventDefault(),this.itemIndex=t.currentTarget.dataset.index,this.highlightItem(),this.selectItem()}renderList(t,i,e){if(i&&i.length>0){this.values=i,this.mentionList.innerHTML="";for(let n=0;n<i.length;n+=1){const s=document.createElement("li");s.className="ql-mention-list-item",s.dataset.index=n,s.dataset.id=i[n].id,s.dataset.value=i[n].value,s.dataset.denotationChar=t,i[n].link&&(s.dataset.link=i[n].link),s.innerHTML=this.options.renderItem(i[n],e),s.onmouseenter=this.onItemMouseEnter.bind(this),s.onclick=this.onItemClick.bind(this),this.mentionList.appendChild(s)}this.itemIndex=0,this.highlightItem(),this.showMentionList()}else this.hideMentionList()}nextItem(){this.itemIndex=(this.itemIndex+1)%this.values.length,this.suspendMouseEnter=!0,this.highlightItem()}prevItem(){this.itemIndex=(this.itemIndex+this.values.length-1)%this.values.length,this.suspendMouseEnter=!0,this.highlightItem()}hasValidChars(t){return this.options.allowedChars.test(t)}containerBottomIsNotVisible(t,i){const e=t+this.mentionContainer.offsetHeight+i.top;return e>window.pageYOffset+window.innerHeight}containerRightIsNotVisible(t,i){if(this.options.fixMentionsToQuill)return!1;const e=t+this.mentionContainer.offsetWidth+i.left,n=window.pageXOffset+document.documentElement.clientWidth;return e>n}setMentionContainerPosition(){const t=this.quill.container.getBoundingClientRect(),i=this.quill.getBounds(this.mentionCharPos),e=this.mentionContainer.offsetHeight;let n=this.options.offsetTop,s=this.options.offsetLeft;if(this.options.fixMentionsToQuill?this.mentionContainer.style.right="0px":s+=i.left,this.containerRightIsNotVisible(s,t)){const i=this.mentionContainer.offsetWidth+this.options.offsetLeft;s=t.width-i}if("top"===this.options.defaultMenuOrientation){if((n=this.options.fixMentionsToQuill?-1*(e+this.options.offsetTop):i.top-(e+this.options.offsetTop))+t.top<=0){let e=this.options.offsetTop;this.options.fixMentionsToQuill?e+=t.height:e+=i.bottom,n=e}}else if(this.options.fixMentionsToQuill?n+=t.height:n+=i.bottom,this.containerBottomIsNotVisible(n,t)){let t=-1*this.options.offsetTop;this.options.fixMentionsToQuill||(t+=i.top),n=t-e}this.mentionContainer.style.top=`${n}px`,this.mentionContainer.style.left=`${s}px`,this.mentionContainer.style.visibility="visible"}onSomethingChange(){const t=this.quill.getSelection();if(null==t)return;this.cursorPos=t.index;const i=Math.max(0,this.cursorPos-this.options.maxChars),e=this.quill.getText(i,this.cursorPos-i),n=this.options.mentionDenotationChars.reduce((t,i)=>{const n=t,s=e.lastIndexOf(i);return s>n?s:n},-1);if(n>-1){if(this.options.isolateCharacter&&0!=n&&!e[n-1].match(/\s/g))return void this.hideMentionList();const t=this.cursorPos-(e.length-n);this.mentionCharPos=t;const i=e.substring(n+1);if(i.length>=this.options.minChars&&this.hasValidChars(i)){const t=e[n];this.options.source(i,this.renderList.bind(this,t),t)}else this.hideMentionList()}else this.hideMentionList()}onTextChange(t,i,e){"user"===e&&this.onSomethingChange()}onSelectionChange(t){t&&0===t.length?this.onSomethingChange():this.hideMentionList()}}s.a.register("modules/mention",r),i.default=r},function(t,i,e){t.exports=e(1)},,function(t,i){}]);